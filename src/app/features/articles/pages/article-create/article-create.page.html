<main class="container">
  <header class="header">
    <div>
      <a class="btn ghost" [routerLink]="['/articles']">← Back</a>
      <h1 class="pageTitle">New article</h1>
      <p class="subTitle">Local-only (no auth yet)</p>
    </div>
  </header>

  <section class="card formCard">
    <form class="form" (submit)="$event.preventDefault(); submit()">
      <label class="field">
        <span class="labelText">Title</span>
        <input
          class="input"
          type="text"
          placeholder="A clear title…"
          maxlength="120"
          [attr.aria-invalid]="!!titleError()"
          [value]="title()"
          (input)="title.set(($any($event.target).value))"
        />
        <div class="metaRow" aria-hidden="true">
          <span class="muted">Max 120</span>
          <span class="muted">{{ titleTrimmedLen() }}/120</span>
        </div>
        @if (titleError()) {
          <p class="error">{{ titleError() }}</p>
        }
      </label>

      <label class="field">
        <span class="labelText">Content</span>
        <textarea
          class="input textarea"
          rows="10"
          placeholder="Write something…"
          maxlength="10000"
          [attr.aria-invalid]="!!contentError()"
          [value]="content()"
          (input)="content.set(($any($event.target).value))"
          (paste)="onCreatePaste($event)"
        ></textarea>
        <div class="metaRow" aria-hidden="true">
          <span class="muted">Min 10</span>
          <span class="muted">{{ contentTrimmedLen() }}/10000</span>
        </div>
        @if (contentError()) {
          <p class="error">{{ contentError() }}</p>
        }
      </label>

      <label class="field">
        <span class="labelText">Images (optional)</span>
        <div class="imageUploadContainer">
          <input
            type="file"
            multiple
            accept="image/*"
            class="fileInput"
            (change)="onImageSelect($event)"
            [disabled]="selectedImages().length >= 10"
          />
          <p class="muted">Max 10 images, 5MB each</p>
        </div>
        
        @if (imagePreviews().length > 0) {
          <div class="imagePreviewsContainer">
            @for (preview of imagePreviews(); let i = $index; track i) {
              <div class="imagePreview">
                <img [src]="preview.url" [alt]="preview.name" />
                <button
                  type="button"
                  class="btn removeImageBtn"
                  (click)="removeImage(i)"
                  aria-label="Remove image"
                >
                  ✕
                </button>
              </div>
            }
          </div>
        }
      </label>

      <div class="actions">
        <a class="btn" [routerLink]="['/articles']">Cancel</a>
        <button type="submit" class="btn" [disabled]="!canSubmit() || submitting()">
          @if (submitting()) { Creating… } @else { Create }
        </button>
      </div>

      @if (attemptedSubmit() && !canSubmit()) {
        <p class="muted hint">Fix the fields above to continue.</p>
      }
    </form>
  </section>
</main>
