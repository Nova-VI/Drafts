<main class="container">
  <header class="header">
    <div>
      <h1 class="pageTitle">Articles</h1>
    </div>


    <div class="headerActions">
      @if (authService.isAuthenticated()) {
        <button type="button" class="btn iconTextBtn" [routerLink]="['/articles/new']">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>New Article</span>
        </button>
      }
      <div class="searchControls" style="display:flex;gap:8px;align-items:center">
        <input
          class="input search"
          type="search"
          placeholder="Search title, content…"
          [value]="query()"
          (input)="setQuery(($any($event.target).value))"
          aria-label="Search articles"
        />

        <input
          class="input"
          type="search"
          placeholder="Author"
          [value]="filters().author"
          (input)="setAuthor($any($event.target).value)"
          aria-label="Filter by author"
        />

        <div class="relative-dropdown">
          <button type="button" class="relative-btn" (click)="toggleRelativeOpen()" aria-haspopup="listbox" [attr.aria-expanded]="relativeOpen()">
            {{ selectedRelative() }} <span class="caret">▾</span>
          </button>
          @if (relativeOpen()) {
            <ul class="relative-menu" role="listbox">
              <li *ngFor="let opt of relativeOptions" class="relative-item" role="option" (click)="setSinceRelative(opt.value); toggleRelativeOpen()">{{ opt.label }}</li>
            </ul>
          }
        </div>
      </div>
    </div>
  </header>

  @if (articles().length === 0) {
    <section class="empty card">
      <p>No articles match your search.</p>
    </section>
  } @else {
    <section class="list">
      @for (a of articles(); track a.id) {
        <article class="row card">
          <section class="content">
            <div class="meta">
              <a [routerLink]="['/profile', a.ownerUsername]" class="author authorLink">{{ a.ownerUsername }}</a>
              <span class="dot">•</span>
              <time class="date">{{ a.createdAt | relativeTime }}</time>
              <span class="dot">•</span>
              <span class="reading">{{ readingMinutesOf(a) }} min read</span>
            </div>

            <h2 class="cardTitle">
              <a class="titleLink" [routerLink]="['/articles', a.id]">
                {{ a.title }}
              </a>
            </h2>
            <p class="excerpt">{{ excerptOf(a) }}</p>

            @if (a.images.length > 0) {
              <a class="thumbLink" [routerLink]="['/articles', a.id]">
                <img class="thumb" [src]="a.images[0]" [alt]="a.title" />
              </a>
            }
            <div class="actions" aria-label="Post actions">
              <button
                type="button"
                class="btn voteBtn"
                [class.active]="store.isUpvoted(a)"
                (click)="store.upvote(a.id)"
                [disabled]="!authService.isAuthenticated()"
                aria-label="Upvote"
              >
                <span class="icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 11V20" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                    <path d="M6 11h4l5.4-6.3c.6-.7 1.7-.2 1.6.7l-.7 5.6H20a2 2 0 0 1 2 2.2l-1.1 7A2 2 0 0 1 18.9 22H10a4 4 0 0 1-4-4v-7Z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
                  </svg>
                </span>
                <span class="label">{{ a.upvotes }}</span>
              </button>

              <button
                type="button"
                class="btn voteBtn"
                [class.activeDown]="store.isDownvoted(a)"
                (click)="store.downvote(a.id)"
                [disabled]="!authService.isAuthenticated()"
                aria-label="Downvote"
              >
                <span class="icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M14 13V4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                    <path d="M18 13h-4L8.6 19.3c-.6.7-1.7.2-1.6-.7l.7-5.6H4a2 2 0 0 1-2-2.2l1.1-7A2 2 0 0 1 5.1 2H14a4 4 0 0 1 4 4v7Z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
                  </svg>
                </span>
                <span class="label">{{ a.downvotes }}</span>
              </button>

              <button
                type="button"
                class="btn voteBtn"
                [routerLink]="['/articles', a.id]"
                fragment="comments"
                aria-label="Comments"
              >
                <span class="icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7.5 8h9M7.5 12h6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                    <path d="M3 20.29V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H7.961a2 2 0 0 0-1.561.75l-2.331 2.914A.6.6 0 0 1 3 20.29Z" stroke="currentColor" stroke-width="1.8"/>
                  </svg>
                </span>
                <span class="label">{{ a.comments.length }}</span>
              </button>
            </div>

            @if (a.slug) {
              <div class="tags">
                <span class="pill">{{ a.slug }}</span>
              </div>
            }
          </section>
        </article>
      }
    </section>
  }
</main>
